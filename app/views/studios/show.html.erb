<h1>Studio Details</h1>
<script src="//maps.google.com/maps/api/js?key=<%=ENV['GOOGLE_MAPS_API_KEY'] %>&libraries=geometry&language=&hl=&region="></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->


<h3><%= @studio.name %></h3>
<p>Average Rating: <%=@studio.average_rating  %> </p>
<div class="studio-cal-container" style="width: 600px">
  <div id='studiocal'>
  </div>
</div>

<p>Address:<br>
<p><%= @studio.full_address %></p>

<p><%= @studio.description %></p>

<p>$<%= @studio.price %> per hour</p>

<p><%= @studio.website %></p>

<% if @studio.images.any? %>
  <% @studio.images.each do |image| %>
    <%= image_tag image.media.url(:medium)  %>
  <% end %>
<% end %><br>
<%= link_to 'Set Availabilities', studio_availabilities_path(@studio) %><br>
<%= link_to 'Add Photos', new_studio_image_path(@studio) %>

<% if @errors %>
<div class="errors">
  <ul>
    <% @errors.each do |error| %>
      <li><%= error %></li>
    <% end %>
  </ul>
  <% end %>
</div>

<p id="basicExampleStatus"></p>
<h3>Request Studio Time:</h3>
<form id="basicExample" action="/studios/<%= @studio.id %>/availabilities/10/bookings" method='POST'>
  <input name="authenticity_token" value="<%= form_authenticity_token %>" type='hidden'>
  <input type="text" id="start_date" class="date start" name="start_date"/>
  <input type="text" id="s_time" class="time start" name="s_time"/> to
  <input type="text" id="end_date" class="date end" name="end_date"/>
  <input type="text" id="e_time" class="time end" name="e_time"/>
  <input type="submit" value="Request Studio Time">
</form>


<script>
  $('#basicExample .time').timepicker({
      'showDuration': true,
      'timeFormat': 'g:ia'
  });

  $('#basicExample .date').datepicker({
      'format': 'm/d/yyyy',
      'autoclose': true
  });

  // initialize datepair
  var basicExampleEl = document.getElementById('basicExample');
  var datepair = new Datepair(basicExampleEl);

  // Prevent booking form submission if fields are left blank or date/times are invalid:
  $(document).ready(function() {
    $("#basicExample").on('submit', function(e) {
      var startDate = $("#start_date").val();
      var startTime = $("#s_time").val();
      var endDate = $("#end_date").val();
      var endTime = $("#e_time").val();
      if (startDate == '' || startTime == '' || endDate == '' || endTime == '') {
        e.preventDefault();
        alert("Please Enter a Value for All Fields");
      } else if (startDate > endDate){
        e.preventDefault();
        alert("INVALID DATES: End Date must be later than Start Date!");
      } else if (startDate <= endDate && startTime >= endTime){
        e.preventDefault();
        alert("INVALID TIMES: End Time must be later than Start Time!");
      }
    });
  });

</script>

<div class="row">
  <div class="col-md-12">
  <div id="map"></div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ internal: {id: 'map'}}, function(){
    marker = handler.addMarkers([
      {
        lat: <%= @latitude %>,
        lng: <%= @longitude %>,
      }
    ]);
  handler.bounds.extendWith(marker);
  handler.fitMapToBounds();
  handler.getMap().setZoom(10);
  });

</script>
  </div>
</div>


